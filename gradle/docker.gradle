bootBuildImage {
    environment = [
        BP_JMX_ENABLED: 'true',
        BP_DEBUG_ENABLED: 'true'
    ]
    imageName = System.env.IMAGE ?: imageName.get() // for skaffold
}

task bootDockerRun {
    dependsOn bootBuildImage
    doLast {
        def envVars = [
                "HTTP_PORT=$HTTP_PORT",
                "JMX_PORT=$JMX_PORT",
                "DEBUG_PORT=$DEBUG_PORT",
                "LOGS_HOME=$projectDir/logs",
                "JAVA_TOOL_OPTIONS=${commonJvmArgs.join(' ')}",
                "APP_IMAGE=$project.name:$project.version"
        ]

        "docker compose --project-name $project.name up".execute(envVars, file('docker')).waitForProcessOutput(System.out, System.err)
    }
}
